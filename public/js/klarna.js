$(document).ready(function(){$("#klarna");var t=$("#klarnaCheckoutBtn"),e=$("#cartId").val(),i={items:[]};function n(t){$.get("/ostoskori/"+e+"/ajax",function(e){if(!e.items.length)return t(!0,!1);var n={reference:e.delivery_cost._id,name:e.delivery_cost.name,quantity:parseInt(e.delivery_cost.quantity,10),unit_price:100*Number(e.delivery_cost.unit_price),tax_rate:100*parseInt(e.delivery_cost.tax_rate,10),type:e.delivery_cost.unit_type};if(e.bonus_system.coupon_id){var r={reference:e.bonus_system.coupon_id,name:"Hyvitys",quantity:1,unit_price:100*parseInt(-e.bonus_system.coupon_value,10),tax_rate:0,type:"discount"};i.items.push(r)}i.items.push(n);for(var o=0,s=0;s<e.items.length;s++){var a={reference:e.items[s]._id,name:e.items[s].item.fullname,quantity:parseInt(e.items[s].quantity),unit_price:100*parseInt(e.items[s].unit_price),tax_rate:100*parseInt(e.items[s].tax_rate),image_uri:e.items[s].item.cover,uri:"https://rollingrecords.fi/lp:t/"+e.items[s].item._id,type:e.items[s].item.unit_type};if(i.items.push(a),++o===e.items.length)return t(!1,!0)}})}if("Nouto myymälästä"===$("#delivery_method").val()?t.on("click",function(t){t.preventDefault(),$(this).prop("disabled",!0),n(function(t,n){t?console.error("Jotain meni peileen."):$.ajax({url:"/ostoskori/"+e+"/maksu",type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",success:function(t){$("#klarna").html(t.snippet)},error:function(t){console.log(t),$("#klarna").html("Error: "+t.responseText)}})})}):n(function(t,n){t?console.error("Jotain meni peileen."):$.ajax({url:"/ostoskori/"+e+"/maksu",type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",success:function(t){$("#klarna").html(t.snippet)},error:function(t){console.log(t),$("#klarna").html("Error: "+t.responseText)}})}),window.location.pathname===`/ostoskori/${e}/vahvistus`){var r=$("#klarna_id").val();void 0!==r&&$.get(`/ostoskori/${e}/tilaus?klarna_id=${r}`,function(t){console.log(t),$("#klarna_order").html(t.gui.snippet)})}});